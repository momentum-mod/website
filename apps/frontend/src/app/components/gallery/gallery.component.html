<div #popover popover="auto" class="h-full w-full bg-transparent p-0">
  <div class="relative flex h-screen w-screen flex-col items-center justify-center bg-black bg-opacity-50 p-[1.5vh] backdrop-blur">
    <div
      class="-z-1 absolute h-full w-full cursor-pointer bg-black bg-opacity-0 transition-colors duration-300 ease-in-out hover:bg-opacity-[0.15]"
      (click)="popover.hidePopover()"
    ></div>
    <button
      type="button"
      class="absolute right-0 top-0 z-20 m-[1.5vh] size-20 rounded-full bg-white bg-opacity-0 transition-colors hover:bg-opacity-10"
      (click)="popover.hidePopover()"
    >
      <m-icon class="size-full p-2" icon="close" />
    </button>

    <button
      type="button"
      class="absolute left-4 z-20 size-32 rounded-full bg-white bg-opacity-0 transition-colors hover:bg-opacity-5"
      (click)="cycleLeft()"
    >
      <m-icon icon="menu-left" class="size-full opacity-85" />
    </button>
    <button
      type="button"
      class="absolute right-4 z-20 size-32 rounded-full bg-white bg-opacity-0 transition-colors hover:bg-opacity-5"
      (click)="cycleRight()"
    >
      <m-icon icon="menu-right" class="size-full opacity-85" />
    </button>

    <div #parent class="pointer-events-none z-10 grid aspect-video min-h-0 basis-[87.5%] place-items-center">
      @if (selectedItem && selectedItem.type === 'image') {
        <img class="pointer-events-auto size-full rounded shadow-lg" [src]="selectedItem.full" />
      } @else if (selectedItem && selectedItem.type === 'youtube') {
        <iframe
          #youtubeIframe
          class="pointer-events-auto size-full shadow-lg"
          type="text/html"
          [src]="selectedItem.safeUrl"
          allowfullscreen="true"
        ></iframe>
      }
    </div>

    @if (items.length > 1) {
      <!-- Make sure high in z-order so clicking in between thumbnails doesn't trigger close (annoying!)-->
      <div class="z-10 mt-[1.5vh] flex min-h-0 basis-[12.5%] items-center justify-center gap-[1.5vh] overflow-x-auto">
        @for (item of items; track $index; let i = $index) {
          <!-- Needed for hover effect -->
          <button
            type="button"
            class="hover-white-overlay h-full w-max shrink-0 items-center overflow-hidden rounded border-2 border-white border-opacity-0 shadow-lg transition-colors"
            [ngClass]="{ 'border-opacity-80': i === selectedItemIndex }"
            (click)="selectItem(i)"
          >
            <img class="h-full min-h-0" [src]="item.type === 'image' ? item.thumbnail : item.safeThumbnail" />
          </button>
        }
      </div>
    }
  </div>
</div>
